@using System.Web.Services.Discovery
@using AS_Store_GL.Models
@model AS_Store_GL.Models.PageModel


@{
    ViewBag.Title = "Index";
    //if (System.Web.HttpContext.Current.Request.Cookies["CI"] == null)
    //{
    //    Response.Redirect(Url.Action("Index", "Login"));
    //}

    //var LoggedUserTp = System.Web.HttpContext.Current.Request.Cookies["UT"].Value;
    //var LoggedCompId = System.Web.HttpContext.Current.Request.Cookies["CI"].Value;
    //var LoggedUserStatus = System.Web.HttpContext.Current.Request.Cookies["US"].Value;
    //var LoggedCompanyStatus = System.Web.HttpContext.Current.Request.Cookies["CS"].Value;
    if (HttpContext.Current.Session["LoggedUserType"] == null)
    {
        Response.Redirect(Url.Action("Index", "Login"));
    }
    var LoggedUserTp = HttpContext.Current.Session["LoggedUserType"].ToString();
    var LoggedCompId = HttpContext.Current.Session["loggedCompID"].ToString();
    var LoggedUserStatus = HttpContext.Current.Session["LoggedUserStatus"].ToString();
    var LoggedCompanyStatus = HttpContext.Current.Session["LoggedCompanyStatus"].ToString();

    if ((LoggedUserTp == "CompanyAdmin" || LoggedUserTp == "UserAdmin" || LoggedUserTp == "User") && LoggedUserStatus == "A" && LoggedCompanyStatus == "A")
    {

    }
    else
    {
        Response.Redirect(Url.Action("Index", "Logout"));
    }

    Store_GL_DbContext db = new Store_GL_DbContext();
    Int64 compid = Convert.ToInt64(HttpContext.Current.Session["loggedCompID"].ToString());
    Int64 loggedUserID = Convert.ToInt64(HttpContext.Current.Session["loggedUserID"].ToString());
    var permission_Check = from m in db.AslRoleDbSet where m.COMPID == compid && m.USERID == loggedUserID && m.CONTROLLERNAME == "Transfer" select m;
    var createStatus = "";
    var updateStatus = "";
    foreach (var check in permission_Check)
    {
        createStatus = check.INSERTR;
        updateStatus = check.UPDATER;
    }

    if (createStatus == "A")
    {

    }
    else if (updateStatus == "A")
    {
        Response.Redirect("~/Transfer/EditOrder");
    }


    if (createStatus == "I" && updateStatus == "I")
    {
        Response.Redirect("~/GraphView/Index");
    }





    List<SelectListItem> category = new List<SelectListItem>();
    var result = (from n in db.StkItemmstDbSet where n.COMPID == compid select n).ToList();
    foreach (var n in result)
    {
        STK_ITEMMST stkItemmst = db.StkItemmstDbSet.FirstOrDefault(e => e.CATID == n.CATID);
        category.Add(new SelectListItem { Text = stkItemmst.CATNM, Value = stkItemmst.CATID.ToString() });
    }



    List<SelectListItem> storeList = new List<SelectListItem>();
    var findStoreName = (from n in db.StkStoreDbSet where n.COMPID == compid select n).ToList();
    foreach (var Stk_store in findStoreName)
    {
        storeList.Add(new SelectListItem { Text = Stk_store.STORENM, Value = Stk_store.STOREID.ToString() });
    }



    //List<SelectListItem> PartyList = new List<SelectListItem>();
    //var findPartyID = (from n in db.GlAcchartDbSet where n.COMPID == compid select n).ToList();
    //Int64 headCD = 0;
    //foreach (var glAcchart in findPartyID)
    //{
    //    headCD = Convert.ToInt64(glAcchart.HEADCD.ToString().Substring(3, 3));
    //    if (headCD == 103)
    //    {
    //        PartyList.Add(new SelectListItem { Text = glAcchart.ACCOUNTNM, Value = glAcchart.ACCOUNTCD.ToString() });
    //    }

    //}


    Int64 transno = 0;
    decimal totGross = 0;
    decimal totAmt = 0;
    int i = 1;

    TimeZoneInfo timeZoneInfo;
    timeZoneInfo = TimeZoneInfo.FindSystemTimeZoneById("Central Asia Standard Time");
    DateTime currentDateTime = TimeZoneInfo.ConvertTime(DateTime.Now, timeZoneInfo);
}




@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)


    @Html.HiddenFor(model => model.StkTrans.COMPID, new { id = "txtCompId", @Value = LoggedCompId })
    @Html.HiddenFor(model => model.StkTrans.ITEMSL, new { id = "txtItemSl" })
    @Html.HiddenFor(model => model.StkTrans.ITEMID, new { id = "txtItemId" })

    <div id="contentHeaderBox">
        <h1 style="padding-left: 16px;">Transfer Information - (Create)</h1>
        <div class="btn-group pull-right" id="editOption">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" aria-expanded="false">
                <i class="fa fa-cog"></i>
            </button>
            <ul class="dropdown-menu pull-right" style="" role="menu">
                @if (createStatus == "A" && updateStatus == "A")
                {
                    <li><a href="@Url.Action("Index", "Transfer")"><i class="fa fa-plus"></i> Create</a></li>
                    <li><a href="@Url.Action("EditOrder", "Transfer")"><i class="fa fa-edit"></i> Update</a></li>
                }
                else if (createStatus == "A")
                {
                    <li><a href="@Url.Action("Index", "Transfer")"><i class="fa fa-plus"></i> Create</a></li>
                }
                else if (updateStatus == "A")
                {
                    <li><a href="@Url.Action("EditOrder", "Transfer")"><i class="fa fa-edit"></i> Update</a></li>
                }
            </ul>
        </div>

    </div>

    <div class="col-md-12">
        <div class="form-group">
            <div class="col-md-8">
                @if (TempData["UpdatePermission"] != null)
                {
                    <h4 style="color: #C03523">@TempData["UpdatePermission"]</h4>
                }
                <div class="row">

                    <div class="col-md-4">
                        <span> <b>  Date</b></span>
                        @if (TempData["transdate"] != null)
                        {
                            string date = TempData["transdate"].ToString();
                            DateTime MyDateTime = DateTime.Parse(date);
                            string Date = MyDateTime.ToString("dd-MMM-yyyy");
                            @Html.TextBoxFor(model => model.StkTrans.TRANSDT, new { @class = "form-control input-sm", @readonly = "readonly", @Value = Date })
                        }
                        else
                        {
                            @Html.TextBoxFor(model => model.StkTrans.TRANSDT, new { @class = "form-control input-sm", @id = "txtdate", @Value = currentDateTime.ToString("dd-MMM-yyyy") })
                            if (ViewBag.errorDate != null)
                            {
                                <h6 style="color: #C03523">@ViewBag.errorDate</h6>
                            }
                        }
                    </div>
                    <div class="col-md-3">
                        <span> <b>  Year</b></span>
                        @if (TempData["transYear"] != null)
                        {
                            string year = TempData["transYear"].ToString();
                            @Html.TextBoxFor(model => model.StkTrans.TRANSYY, new { @class = "form-control input-sm", @id = "txtYear", @readonly = "readonly", @Value = year })
                        }
                        else
                        {
                            @Html.TextBoxFor(model => model.StkTrans.TRANSYY, new { @class = "form-control input-sm", @id = "txtYear", @readonly = "readonly", @Value = currentDateTime.ToString("yyyy") })
                        }
                    </div>

                    <div class="col-md-5">
                        <span> <b>  Memo No</b></span>
                        @Html.TextBoxFor(model => model.StkTrans.TRANSNO, new { id = "txtTransNo", @class = "form-control input-sm", @readonly = "readonly" })
                    </div>
                </div>

                <div class="row">

                    <div class="col-md-6">
                        <span> <b>  Store From</b></span>
                        @if (TempData["STOREFR"] != null)
                        {
                            @Html.HiddenFor(model => model.StkTrans.STOREFR, new { @class = "form-control input-sm" })
                            Int64 storeid = Convert.ToInt64(TempData["STOREFR"]);
                            var StoreName = (from n in db.StkStoreDbSet where n.COMPID == compid && n.STOREID == storeid select n).ToList();
                            string store_Name = "";
                            foreach (var Name in StoreName)
                            {
                                store_Name = Name.STORENM;
                            }
                            @Html.TextBoxFor(model => model.StkStore.STORENM, new { @class = "form-control input-sm", @readonly = "readonly", @Value = store_Name })

                        }
                        else
                        {
                            @Html.DropDownListFor(model => model.StkTrans.STOREFR, storeList, "--Select--", new { @class = "form-control input-sm", @id = "ddlstoreName", autofocus = true })
                            if (ViewBag.errorStoreName_StoreFor != null)
                            {
                                <h6 style="color: #C03523">@ViewBag.errorStoreName_StoreFor</h6>
                            }
                        }
                    </div>
                    <div class="col-md-6">
                        <span> <b>  Store To</b></span>
                        @if (TempData["STORETO"] != null)
                        {
                            @Html.HiddenFor(model => model.StkTrans.STORETO, new { @class = "form-control input-sm" })
                            Int64 storeid = Convert.ToInt64(TempData["STORETO"]);
                            var StoreName = (from n in db.StkStoreDbSet where n.COMPID == compid && n.STOREID == storeid select n).ToList();
                            string store_Name = "";
                            foreach (var Name in StoreName)
                            {
                                store_Name = Name.STORENM;
                            }
                            @Html.TextBoxFor(model => model.StkStore.STORENM, new { @class = "form-control input-sm", @readonly = "readonly", @Value = store_Name })

                        }
                        else
                        {
                            @Html.DropDownListFor(model => model.StkTrans.STORETO, storeList, "--Select--", new { @class = "form-control input-sm", @id = "ddlstoreName" })
                            if (ViewBag.errorStoreName_StoreTo != null)
                            {
                                <h6 style="color: #C03523">@ViewBag.errorStoreName_StoreTo</h6>
                            }
                        }
                    </div>
                </div>

                <br />

                <div class="row">
                    @Html.HiddenFor(model => model.StkTrans.STK_TRANS_ID)

                    <div class="col-md-3">
                        <span> @Html.Label("name", "Category", htmlAttributes: new { @class = "control-label" })</span>
                        @Html.DropDownListFor(model => model.StkItemmst.CATID, category, "-Select-", new { id = "txtCatID", @class = "form-control input-sm" })
                    </div>
                    <div class="col-md-6">
                        <span> @Html.Label("name", "Item Name", htmlAttributes: new { @class = "control-label" })</span>
                        @Html.TextBoxFor(model => model.StkItem.ITEMNM, new { @class = "form-control input-sm", id = "txtItemNm" })
                        @if (ViewBag.errorItemid != null)
                        {
                            <h6 style="color: #C03523">@ViewBag.errorItemid</h6>
                        }
                    </div>
                    <div class="col-md-2">
                        <span>  @Html.Label("name", "Quantity", htmlAttributes: new { @class = "control-label" })</span>
                        @Html.TextBoxFor(model => model.StkTrans.QTY, new { @class = "form-control input-sm", id = "txtQty" })
                        @if (ViewBag.errorQty != null)
                        {
                            <h6 style="color: #C03523">@ViewBag.errorQty</h6>
                        }
                    </div>

                    @Html.TextBoxFor(model => model.StkTrans.INSLTUDE, new { id = "latlon", style = "display: none;" })
                    <input id="lat" type="hidden" />
                    <input id="lon" type="hidden" />

                    <div class="col-md-1" style="text-align: right">
                        <br />
                        <input type="submit" class="btn btn-info" value="Add" id="btnAdd" name="command" style="padding-left: 7px;padding-right: 7px;margin-left: -22px" />
                    </div>
                </div>




                @if (ViewBag.InsertPermission != null)
                {
                    <div class="row">
                        <div class="col-md-6"> </div>
                        <div class="col-md-6"> <h5 style="color: #C03523; text-align: right">@ViewBag.InsertPermission</h5></div>
                    </div>
                }




                <div class="row">

                    <div class="col-md-2">
                        <span>  @Html.Label("name", "Rate", htmlAttributes: new { @class = "control-label" })</span>
                        @Html.TextBoxFor(model => model.StkTrans.RATE, new { @class = "form-control input-sm", id = "txtRate" })
                    </div>
                    <div class="col-md-3">
                        <span>  @Html.Label("name", "Amount", htmlAttributes: new { @class = "control-label" })</span>
                        @Html.TextBoxFor(model => model.StkTrans.AMOUNT, new { @class = "form-control input-sm", id = "txtAmt", @readonly = "readonly" })
                    </div>
                    <div class="col-md-2">
                        <span>  @Html.Label("name", "Discount(%)", htmlAttributes: new { @class = "control-label" })</span>
                        @Html.TextBoxFor(model => model.StkTrans.DISCRT, new { @class = "form-control input-sm", id = "txtDscRT", @readonly = "readonly", @Value = 0 })
                    </div>
                    <div class="col-md-2">
                        <span>  @Html.Label("name", "Discount", htmlAttributes: new { @class = "control-label" })</span>
                        @Html.TextBoxFor(model => model.StkTrans.DISCAMT, new { @class = "form-control input-sm", id = "txtDscAmt", @readonly = "readonly", @Value = 0 })
                    </div>
                    <div class="col-md-3">
                        <span>  @Html.Label("name", "Gross Amount", htmlAttributes: new { @class = "control-label" })</span>
                        @Html.TextBoxFor(model => model.StkTrans.GROSSAMT, new { @class = "form-control input-sm", id = "txtGrossAmt", @readonly = "readonly" })
                    </div>
                    @*}*@

                </div>


                <br />
                <br />


                @if (TempData["transno"] != null && TempData["transdate"] != null && TempData["transYear"] != null)
                {
                    string x = Convert.ToString(TempData["transdate"]);
                    DateTime date = DateTime.Parse(x);
                    transno = Convert.ToInt64(TempData["transno"]);

                    Int64 transYear = Convert.ToInt64(TempData["transYear"]);

                    var res = db.StkItemDbSet.Join(db.StkTransDbSet, e => e.ITEMID, b => b.ITEMID,
                        (e, b) => new
                        {
                            itemname = e.ITEMNM,
                            STK_TRANSid = b.STK_TRANS_ID,
                            ITEMSL = b.ITEMSL,
                            ITEMID = b.ITEMID,
                            QTY = b.QTY,
                            RATE = b.RATE,
                            AMOUNT = b.AMOUNT,
                            DISCRT = b.DISCRT,
                            DISCAMT = b.DISCAMT,
                            GROSSAMT = b.GROSSAMT,
                            TRANSNO = b.TRANSNO,
                            TRANSDT = b.TRANSDT,
                            b.TRANSYY,
                            b.TRANSTP,
                            COMPID = b.COMPID
                        }).Where(eAndb => eAndb.TRANSNO == transno && eAndb.TRANSDT == date && eAndb.TRANSYY == transYear && eAndb.TRANSTP == "ITRF" && eAndb.COMPID == compid).OrderBy(e => e.ITEMSL);


                    <div class="table-responsive">
                        <table class="table table-striped">
                            <tr>
                                <td>
                                    <h6>SL</h6>
                                </td>
                                <td>
                                    <h6>Item Name</h6>
                                </td>
                                <td>
                                    <h6>Quantity</h6>
                                </td>
                                @*<td>
                                        <h6>Amount</h6>
                                    </td>
                                    <td>
                                        <h6>Discount Amount</h6>
                                    </td>*@
                                <td>
                                    <h6>Gross Amount</h6>
                                </td>

                                <td></td>
                                <td></td>
                            </tr>
                            @foreach (var item in res)
                            {
                                <tr>
                                    @Html.HiddenFor(model => item.STK_TRANSid, new { id = "txtID", @readonly = "readonly" })
                                    @Html.HiddenFor(model => item.TRANSDT, new { id = "txtID", @readonly = "readonly" })
                                    @Html.HiddenFor(model => item.TRANSYY, new { id = "txtID", @readonly = "readonly" })
                                    @Html.HiddenFor(model => item.ITEMID, new { id = "txtItemId", @readonly = "readonly" })
                                    @Html.HiddenFor(model => item.RATE, new { id = "txtRate", @readonly = "readonly" })
                                    @Html.HiddenFor(model => item.DISCRT, new { id = "txtDscRT", @readonly = "readonly" })
                                    <td>
                                        @Html.TextBoxFor(model => item.ITEMSL, new { style = "width:2em;", id = "txtItemSl", @readonly = "readonly" })
                                    </td>
                                    <td>
                                        @Html.TextBoxFor(model => item.itemname, new { style = "width:12em;", id = "txtItemNm", @readonly = "readonly" })
                                    </td>
                                    <td>
                                        @Html.TextBoxFor(model => item.QTY, new { style = "width:4em; text-align:right", id = "txtQty", @readonly = "readonly" })
                                    </td>
                                    @Html.HiddenFor(model => item.AMOUNT, new { id = "txtAmt", @readonly = "readonly" })
                                    @Html.HiddenFor(model => item.DISCAMT, new { id = "txtDscAmt", @readonly = "readonly" })
                                    @*<td>
                                            @Html.TextBoxFor(model => item.AMOUNT, new { style = "width:6em; text-align:right", id = "txtAmt", @readonly = "readonly" })
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(model => item.DISCAMT, new { style = "width:6em; text-align:right", id = "txtDscAmt", @readonly = "readonly" })
                                        </td>*@
                                    <td>
                                        @Html.TextBoxFor(model => item.GROSSAMT, new { style = "width: 7em; text-align:right", id = "txtGrossAmt", @readonly = "readonly" })
                                    </td>

                                    <td>
                                        <span>
                                            <a href="@Url.Action("OrderDelete", new { tid = item.STK_TRANSid, orderNo = item.TRANSNO,Date = item.TRANSDT,Year=item.TRANSYY, itemsl = item.ITEMSL, compid = item.COMPID, item })" class="btn btn-sm btn-danger">
                                                <span class="glyphicon glyphicon-remove"></span>
                                            </a>
                                        </span>
                                    </td>
                                    <td>
                                        <span>
                                            <a href="@Url.Action("OrderUpdate", new { tid = item.STK_TRANSid, orderNo = item.TRANSNO, Date = item.TRANSDT, Year = item.TRANSYY, itemsl = item.ITEMSL, itemId = item.ITEMID, item })" class="btn btn-sm btn-info">
                                                <span class="glyphicon glyphicon-pencil"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                totGross = Convert.ToDecimal(totGross + item.GROSSAMT);
                                totAmt = Convert.ToDecimal(totAmt + item.AMOUNT);
                                i = i + 1;
                            }
                            <tr>
                                <td></td>
                                <td>Total</td>
                                @*<td></td>
                                    <td></td>*@
                                <td></td>
                                <td>
                                    @Html.TextBoxFor(model => model.StkTransmst.TOTAMT, new { style = "width:7em; text-align:right", id = "txtTotGrossAmt", @readonly = "readonly", @Value = totGross })
                                </td>
                                <td></td>
                                <td></td>
                            </tr>
                        </table>
                    </div>
                }
                else
                {
                    <div class="table-responsive">
                        <table class="table table-striped"></table>
                    </div>
                }
            </div>


            <div class="col-md-4">
                <div class="panel panel-primary" style="margin-bottom: 0px">
                    <div class="panel-heading">Particulars</div>
                </div>

                <div class="well">
                    <div class="table-responsive">
                        @if (ViewBag.addItemList != null)
                        {<table>
                            <tr>
                                <td>
                                    <h6 style="color: #C03523">@ViewBag.addItemList</h6>
                                </td>
                            </tr>
                        </table>
                        }
                        <table class="table table-hover">
                            <tr>
                                <td>
                                    Total Amount
                                </td>
                                <td>
                                    @Html.TextBoxFor(model => model.StkTransmst.TOTAMT, new { @style = "width:10em; text-align:right", id = "txtMstTotAmt", @readonly = "readonly", @Value = totGross })
                                </td>
                            </tr>
                            @Html.HiddenFor(model => model.StkTransmst.TOTGROSS, new { @Value = totGross })
                            @Html.HiddenFor(model => model.StkTransmst.TOTNET, new { @Value = totGross })
                            @*<tr>
                                        <td>
                                            Discount (%)
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(model => model.StkTransmst.DISCRTG, new { @style = "width:10em; text-align:right", id = "txtMstDiscRate", @Value = 0 })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            Discount Amount
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(model => model.StkTransmst.DISCAMTG, new { @style = "width:10em; text-align:right", id = "txtMstDiscAmt", @Value = 0 })
                                        </td>
                                    </tr>
                                <tr>
                                    <td>
                                        Gross Amount
                                    </td>
                                    <td>
                                        @Html.TextBoxFor(model => model.StkTransmst.TOTGROSS, new { @style = "width:10em; text-align:right", id = "txtMstTotGross", @readonly = "readonly", @Value = totGross })
                                    </td>
                                </tr>
                                <tr>
                                        <td>
                                            Vat (%)
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(model => model.StkTransmst.VATRT, new { @style = "width:10em; text-align:right", id = "txtMstVatRT", @Value = 0 })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            Vat Amount
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(model => model.StkTransmst.VATAMT, new { @style = "width:10em; text-align:right", id = "txtMstVatAmt", @readonly = "readonly", @Value = 0 })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            Other Charge
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(model => model.StkTransmst.OTCAMT, new { @style = "width:10em; text-align:right", id = "txtMstServiceAmt", @Value = 0 })
                                        </td>
                                    </tr>
                                <tr>
                                    <td>
                                        Net Amount
                                    </td>
                                    <td>
                                        @Html.TextBoxFor(model => model.StkTransmst.TOTNET, new { @style = "width:10em; text-align:right", id = "txtMstNetAmount", @readonly = "readonly", @Value = totGross })
                                    </td>
                                </tr>
                                <tr>
                                        <td>
                                            Cash Amount
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(model => model.StkTransmst.CASHAMT, new { @style = "width:10em; text-align:right", id = "txtMstCashAmount", @Value = 0 })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            Credit Amount
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(model => model.StkTransmst.CREDITAMT, new { @style = "width:10em; text-align:right", id = "txtMstCreditAmount", @readonly = "readonly", @Value = 0 })
                                        </td>
                                    </tr>*@
                            <tr>
                                <td>
                                    Remarks
                                </td>
                                <td>
                                    @Html.TextAreaFor(model => model.StkTransmst.REMARKS, new { @style = "width:10em; text-align:right" })
                                </td>
                            </tr>
                        </table>

                        <table>
                            <tr>
                                <td style="width: 30%;"></td>
                                <td>
                                    <input type="submit" class="btn btn-danger" value="Save" id="btnComp" name="command" />
                                    <input type="submit" id="POS_ButtonId" class="btn btn-primary" name="command" value="POS" data-toggle="tooltip" data-placement="bottom" title="Paper size small" formtarget="_blank" />
                                    <input type="submit" id="A4_ButtonId" class="btn btn-success" name="command" value="A4" data-toggle="tooltip" data-placement="bottom" title="Paper size A4" formtarget="_blank" />
                                </td>
                            </tr>
                        </table>


                    </div>
                </div>

                @Html.TextBoxFor(model => model.StkTransmst.INSLTUDE, new { id = "latlon_StkTransMst", style = "display: none;" })
                <input id="lat" type="hidden" />
                <input id="lon" type="hidden" />

            </div>
        </div>
    </div>


                        //Latitute & longitude
                        <script src="http://maps.google.com/maps/api/js?sensor=false"></script>

                        <script language="javascript" type="text/javascript">
                            $(function () {
                                navigator.geolocation.getCurrentPosition(showPosition);
                                //navigator.geolocation.getCurrentPosition(showPosition, positionError);

                                function showPosition(position) {
                                    var coordinates = position.coords;
                                    $("#lat").val(coordinates.latitude);
                                    $("#lon").val(coordinates.longitude);

                                    $("#latlon").val(
                                        $("#lat").val() + "," + $("#lon").val()
                                    );
                                    $("#latlon_StkTransMst").val(
                                      $("#lat").val() + "," + $("#lon").val()
                                  );
                                }
                            });

                            $(function () {
                                $('[data-toggle="tooltip"]').tooltip();
                            });
                        </script>

                        <script type="text/javascript">

                            $(document).ready(function () {
                                $('#txtItemNm').autocomplete(
                                    {
                                        source: function (request, response) {
                                            $.ajax({
                                                url: '@Url.Action("TagSearch", "Transfer")',
                                                dataType: "json",
                                                data: {
                                                    term: request.term,
                                                    changedDropDown: $('#txtCatID option:selected').val()
                                                },
                                                success: function (data) {
                                                    //response(data);
                                                    response($.map(data, function (item) {
                                                        return {
                                                            label: item,
                                                            value: item
                                                        };
                                                    }));
                                                }
                                            });
                                        },

                                        change: txtOneChanged,
                                        select: function (event, ui) {
                                            $("#txtItemNm").val(ui.item.label);
                                            txtOneChanged();
                                        },
                                    });


                                function txtOneChanged() {
                                    var changedText = $("#txtItemNm").val();
                                    var txtBox = document.getElementById('txtItemId');
                                    var txtRate = document.getElementById('txtRate');
                                    //var txtDscRT = document.getElementById('txtDscRT');
                                    var txtqty = document.getElementById('txtQty');
                                    $.getJSON(
                                        '/Transfer/ItemNameChanged', { "ChangedText": changedText },
                                        function (result) {
                                            txtBox.value = result.itemid;
                                            txtRate.value = result.rate;
                                            //txtDscRT.value = result.discount;
                                            txtqty.value = result.qty;

                                            var myBox1 = document.getElementById('txtQty').value;
                                            var myBox2 = document.getElementById('txtRate').value;
                                            var txtAmt = document.getElementById('txtAmt');
                                            //var txtDscAmt = document.getElementById('txtDscAmt');
                                            var txtGrossAmt = document.getElementById('txtGrossAmt');
                                            //var myBox3 = document.getElementById('txtDscRT').value;
                                            var tottxtAmt = (myBox1 * myBox2);

                                            txtAmt.value = tottxtAmt;
                                            //txtDscAmt.value = tottxtAmt * myBox3 / 100;
                                            //txtGrossAmt.value = tottxtAmt - txtDscAmt.value;
                                            txtGrossAmt.value = tottxtAmt;
                                            document.getElementById("txtQty").focus();
                                        });
                                };



                                $("#txtQty").change(function () {

                                    var myBox1 = document.getElementById('txtQty').value;
                                    var myBox2 = document.getElementById('txtRate').value;
                                    var txtAmt = document.getElementById('txtAmt');
                                    //var txtDscAmt = document.getElementById('txtDscAmt');
                                    var txtGrossAmt = document.getElementById('txtGrossAmt');
                                    //var myBox3 = document.getElementById('txtDscRT').value;
                                    var tottxtAmt = (myBox1 * myBox2);

                                    txtAmt.value = tottxtAmt;
                                    //txtDscAmt.value = tottxtAmt * myBox3 / 100;
                                    //txtGrossAmt.value = tottxtAmt - txtDscAmt.value;
                                    txtGrossAmt.value = tottxtAmt;
                                    document.getElementById("btnAdd").focus();
                                });



                                $("#txtRate").change(function () {

                                    var myBox1 = document.getElementById('txtQty').value;
                                    var myBox2 = document.getElementById('txtRate').value;
                                    var txtAmt = document.getElementById('txtAmt');
                                    //var txtDscAmt = document.getElementById('txtDscAmt');
                                    var txtGrossAmt = document.getElementById('txtGrossAmt');
                                    //var myBox3 = document.getElementById('txtDscRT').value;
                                    var tottxtAmt = (myBox1 * myBox2);

                                    txtAmt.value = tottxtAmt;
                                    //txtDscAmt.value = tottxtAmt * myBox3 / 100;
                                    //txtGrossAmt.value = tottxtAmt - txtDscAmt.value;
                                    txtGrossAmt.value = tottxtAmt;
                                    document.getElementById("btnAdd").focus();
                                });


                                $("#btnAdd").change(function () {
                                    document.getElementById("txtQty").focus();
                                });



                                //$("#txtMstDiscRate").change(function () {


                                //    document.getElementById('txtMstDiscAmt').value = (document.getElementById('txtMstTotAmt').value * (document.getElementById('txtMstDiscRate').value / 100)).toFixed(2);
                                //    document.getElementById('txtMstTotGross').value = (document.getElementById('txtMstTotAmt').value - document.getElementById('txtMstDiscAmt').value).toFixed(2);
                                //    document.getElementById('txtMstVatAmt').value = (document.getElementById('txtMstTotGross').value * (document.getElementById('txtMstVatRT').value / 100)).toFixed(2);
                                //    document.getElementById('txtMstNetAmount').value = (parseFloat(document.getElementById('txtMstTotGross').value) + parseFloat(document.getElementById('txtMstVatAmt').value) + parseFloat(document.getElementById('txtMstServiceAmt').value)).toFixed(2);
                                //    document.getElementById('txtMstCreditAmount').value = (parseFloat(document.getElementById('txtMstNetAmount').value) - parseFloat(document.getElementById('txtMstCashAmount').value)).toFixed(2);

                                //});


                                //$("#txtMstDiscAmt").change(function () {

                                //    document.getElementById('txtMstDiscRate').value = 0;
                                //    document.getElementById('txtMstTotGross').value = (document.getElementById('txtMstTotAmt').value - document.getElementById('txtMstDiscAmt').value).toFixed(2);
                                //    document.getElementById('txtMstVatAmt').value = (document.getElementById('txtMstTotGross').value * (document.getElementById('txtMstVatRT').value / 100)).toFixed(2);
                                //    document.getElementById('txtMstNetAmount').value = (parseFloat(document.getElementById('txtMstTotGross').value) + parseFloat(document.getElementById('txtMstVatAmt').value) + parseFloat(document.getElementById('txtMstServiceAmt').value)).toFixed(2);
                                //    document.getElementById('txtMstCreditAmount').value = (parseFloat(document.getElementById('txtMstNetAmount').value) - parseFloat(document.getElementById('txtMstCashAmount').value)).toFixed(2);
                                //});


                                //$("#txtMstVatRT").change(function () {

                                //    document.getElementById('txtMstTotGross').value = (document.getElementById('txtMstTotAmt').value - document.getElementById('txtMstDiscAmt').value).toFixed(2);
                                //    document.getElementById('txtMstVatAmt').value = (document.getElementById('txtMstTotGross').value * (document.getElementById('txtMstVatRT').value / 100)).toFixed(2);
                                //    document.getElementById('txtMstNetAmount').value = (parseFloat(document.getElementById('txtMstTotGross').value) + parseFloat(document.getElementById('txtMstVatAmt').value) + parseFloat(document.getElementById('txtMstServiceAmt').value)).toFixed(2);
                                //    document.getElementById('txtMstCreditAmount').value = (parseFloat(document.getElementById('txtMstNetAmount').value) - parseFloat(document.getElementById('txtMstCashAmount').value)).toFixed(2);
                                //});


                                //$("#txtMstServiceAmt").change(function () {

                                //    document.getElementById('txtMstTotGross').value = (document.getElementById('txtMstTotAmt').value - document.getElementById('txtMstDiscAmt').value).toFixed(2);
                                //    document.getElementById('txtMstVatAmt').value = (document.getElementById('txtMstTotGross').value * (document.getElementById('txtMstVatRT').value / 100)).toFixed(2);
                                //    document.getElementById('txtMstNetAmount').value = (parseFloat(document.getElementById('txtMstTotGross').value) + parseFloat(document.getElementById('txtMstVatAmt').value) + parseFloat(document.getElementById('txtMstServiceAmt').value)).toFixed(2);
                                //    document.getElementById('txtMstCreditAmount').value = (parseFloat(document.getElementById('txtMstNetAmount').value) - parseFloat(document.getElementById('txtMstCashAmount').value)).toFixed(2);
                                //});



                                //$("#txtMstCashAmount").change(function () {

                                //    document.getElementById('txtMstCreditAmount').value = (parseFloat(document.getElementById('txtMstNetAmount').value) - parseFloat(document.getElementById('txtMstCashAmount').value)).toFixed(2);
                                //});




                                $('#txtdate').datepicker({
                                    dateFormat: "dd-M-yy", changeYear: true
                                });




                                $('#txtdate').change(function () {
                                    //When the UserName (Dropdown list) changed then get the "User ID" from "ASLUSERCO" table
                                    var changedtxt = $('#txtdate').val();
                                    var txtYear = document.getElementById('txtYear');

                                    $("#txtYear").val(" ");
                                    $.getJSON(
                                        "/Transfer/DateChanged_getYear", { "Changedtxt": changedtxt },
                                        function (myData) {
                                            txtYear.value = myData.YEAR;
                                            document.getElementById("ddlstoreName").focus();
                                        });
                                });


                                $('#POS_ButtonId').click(function () {
                                    setTimeout(function () { window.location.reload(); }, 100);
                                });
                                $('#A4_ButtonId').click(function () {
                                    setTimeout(function () { window.location.reload(); }, 100);
                                });

                            });
                        </script>

                        <style type="text/css">
                            .ui-autocomplete {
                                position: absolute;
                                cursor: default;
                                background: #f0ffff;
                                max-height: 200px;
                                overflow-y: auto;
                                /* prevent horizontal scrollbar */
                                overflow-x: hidden;
                                /* add padding to account for vertical scrollbar */
                                padding-right: 20px;
                            }


                            /*html .ui-autocomplete {
                                    width: 1px;
                                }

                                .ui-menu {
                                    list-style: none;
                                    padding: 2px;
                                    margin: 0;
                                    display: block;
                                    float: left;
                                }

                                    .ui-menu .ui-menu {
                                        margin-top: -3px;
                                    }

                                    .ui-menu .ui-menu-item {
                                        margin: 0;
                                        padding: 0;
                                        zoom: 1;
                                        float: left;
                                        clear: left;
                                        width: 100%;
                                    }

                                        .ui-menu .ui-menu-item a {
                                            text-decoration: none;
                                            display: block;
                                            padding: .2em .4em;
                                            line-height: 1.5;
                                            zoom: 1;
                                        }

                                            .ui-menu .ui-menu-item a.ui-state-hover,
                                            .ui-menu .ui-menu-item a.ui-state-active {
                                                font-weight: normal;
                                                margin: -1px;
                                            }*/
                        </style>
}

<link href="~/Content/themes/base/jquery-ui.css" rel="stylesheet" />
<script src="~/Scripts/jquery-1.9.1.min.js"></script>
<script src="~/Scripts/jquery-ui-1.10.4.min.js"></script>


